<!DOCTYPE html>
<html xmlns:v-bind="http://www.w3.org/1999/xhtml">

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>壹栈 | 数据表</title>

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="css/animate.css" rel="stylesheet">
    <link href="css/style.css" rel="stylesheet">



    <link href="css/plugins/dataTables/datatables.min.css" rel="stylesheet">
    <link href="css/plugins/datapicker/datepicker3.css" rel="stylesheet">
    <link href="css/plugins/textSpinners/spinners.css" rel="stylesheet">
<style>
    [v-cloak]{
        display: none;
    }
    body { overflow-y: scroll; }

    .nav-label{
      font-size: 18px;
    }
    .dataTables_filter{
      float: right;
    }
    .control-label {
      font-size: 14px;
    }
    #DataTables_Table_0_wrapper {
      font-size: 14px;
    }
    #DataTables_Table_0_info{
      display: flex;
    }
    #navbar-center{
      margin-left: 30%;
    }

</style>


</head>

<body class="md-skin boxed-layout fixed-nav">

<div id="wrapper">

    <nav class="navbar-default navbar-static-side white-bg" role="navigation" style="margin-top:80px;margin-left:10px" >
        <div class="sidebar-collapse">
            <ul class="nav metismenu" id="side-menu">

              <li >
                  <a href="monitor.html"><i class="fa fa-diamond"></i> <span class="nav-label">位置监控</span> <span class="label label-warning pull-right">13</span></a>
              </li>

              <li class="active">
                  <a href="data_report.html"><i class="fa fa-pie-chart"></i> <span class="nav-label">数据报表</span>  </a>
              </li>

            </ul>

        </div>
    </nav>

    <div id="page-wrapper" class="gray-bg" >
        <div class="row border-bottom">
          <nav class="navbar navbar-fixed-top" role="navigation" style="margin-bottom: 0;display:flex">


              <div class="navbar-header">
                  <a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="#"><i class="fa fa-bars"></i> </a>

              </div>

              <ul class="nav navbar-top-links navbar-right" id="navbar-center">
                  <li class="">
                      <a role="button" href="layouts.html"> 工作台</a>
                  </li>
                  <li class="">
                      <a role="button" href="layouts.html"> 数据分析</a>
                  </li>
                  <li class="">
                      <a role="button" href="layouts.html"> 基本信息</a>
                  </li>
                  <li class="">
                      <a role="button" href="layouts.html"> 服务中心</a>
                  </li>

              </ul>

              <ul class="nav navbar-top-links navbar-right" style="margin-left:10%">
                  <li>
                      <span class="m-r-sm text-muted welcome-message" v-text="'Hi, '+name"></span>
                  </li>
                  <li class="dropdown">
                      <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                          <i class="fa fa-envelope"></i>  <span class="label label-warning">16</span>
                      </a>
                      <ul class="dropdown-menu dropdown-messages">
                          <li>
                              <div class="dropdown-messages-box">
                                  <a href="profile.html" class="pull-left">
                                      <img alt="image" class="img-circle" src="img/a7.jpg">
                                  </a>
                                  <div class="media-body">
                                      <small class="pull-right">46h ago</small>
                                      <strong>Mike Loreipsum</strong> started following <strong>Monica Smith</strong>. <br>
                                      <small class="text-muted">3 days ago at 7:58 pm - 10.06.2014</small>
                                  </div>
                              </div>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <div class="dropdown-messages-box">
                                  <a href="profile.html" class="pull-left">
                                      <img alt="image" class="img-circle" src="img/a4.jpg">
                                  </a>
                                  <div class="media-body ">
                                      <small class="pull-right text-navy">5h ago</small>
                                      <strong>Chris Johnatan Overtunk</strong> started following <strong>Monica Smith</strong>. <br>
                                      <small class="text-muted">Yesterday 1:21 pm - 11.06.2014</small>
                                  </div>
                              </div>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <div class="dropdown-messages-box">
                                  <a href="profile.html" class="pull-left">
                                      <img alt="image" class="img-circle" src="img/profile.jpg">
                                  </a>
                                  <div class="media-body ">
                                      <small class="pull-right">23h ago</small>
                                      <strong>Monica Smith</strong> love <strong>Kim Smith</strong>. <br>
                                      <small class="text-muted">2 days ago at 2:30 am - 11.06.2014</small>
                                  </div>
                              </div>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <div class="text-center link-block">
                                  <a href="mailbox.html">
                                      <i class="fa fa-envelope"></i> <strong>Read All Messages</strong>
                                  </a>
                              </div>
                          </li>
                      </ul>
                  </li>
                  <li class="dropdown">
                      <a class="dropdown-toggle count-info" data-toggle="dropdown" href="#">
                          <i class="fa fa-bell"></i>  <span class="label label-primary">8</span>
                      </a>
                      <ul class="dropdown-menu dropdown-alerts">
                          <li>
                              <a href="mailbox.html">
                                  <div>
                                      <i class="fa fa-envelope fa-fw"></i> You have 16 messages
                                      <span class="pull-right text-muted small">4 minutes ago</span>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <a href="profile.html">
                                  <div>
                                      <i class="fa fa-twitter fa-fw"></i> 3 New Followers
                                      <span class="pull-right text-muted small">12 minutes ago</span>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <a href="grid_options.html">
                                  <div>
                                      <i class="fa fa-upload fa-fw"></i> Server Rebooted
                                      <span class="pull-right text-muted small">4 minutes ago</span>
                                  </div>
                              </a>
                          </li>
                          <li class="divider"></li>
                          <li>
                              <div class="text-center link-block">
                                  <a href="notifications.html">
                                      <strong>See All Alerts</strong>
                                      <i class="fa fa-angle-right"></i>
                                  </a>
                              </div>
                          </li>
                      </ul>
                  </li>


                  <li>
                      <a href="login.html">
                          <i class="fa fa-sign-out"></i> 注销
                      </a>
                  </li>
              </ul>

          </nav>
        </div>


        <div class="wrapper wrapper-content animated fadeInRight" style="margin-left:10px" id="data_report">
            <div class="spiner-example" v-show="isLoading">
                <div class="sk-spinner sk-spinner-double-bounce">
                    <div class="sk-double-bounce1"></div>
                    <div class="sk-double-bounce2"></div>
                </div>
            </div>

            <div class="row" id="search" v-cloak>
              <div class="col-lg-12">
              <div class="ibox float-e-margins">

                  <div class="ibox-content" style="padding-bottom: 0px;">
                    <div class="row">
                        <div class="col-sm-4">
                            <div class="form-group form-inline">
                                <label class="control-label" for="order_id">司机手机:</label>
                                <input type="text" id="order_id" name="order_id" value="" placeholder="司机手机号" class="form-control" v-model="phone">
                            </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group form-inline">
                             <label class="control-label" for="status">司机姓名:</label>
                             <input type="text" id="status" name="status" value="" placeholder="司机姓名" class="form-control" v-model="name">
                         </div>
                        </div>
                        <div class="col-sm-4">
                            <div class="form-group form-inline">
                               <label class="control-label" for="customer">租赁公司:</label>
                                <input type="text" id="customer" name="customer" value="" placeholder="租赁公司" class="form-control">
                         </div>
                    </div>
                    </div>


                      <div class="row">
                    <div class="col-sm-6">
                        <div class="form-group form-inline">
                            <label class="control-label" for="date_added">日期选择:</label>
                            <div class="input-daterange input-group" id="date_added">
                                <input type="text" class="form-control" name="start" v-model="start_time" id="startDate" />
                                <span class="input-group-addon">至</span>
                                <input type="text" class="form-control" name="end" v-model="end_time" id="endDate" />
                              </div>
                        </div>
                    </div>
                    </div>

                  </div>
                  <div class="ibox-footer">

                          <a class="btn btn-success btn-outline" @click="tableReload()">
                              查询
                              <i class="fa fa-search" v-show="!loading"> </i>
                              <span class="loading open-circle" v-show="loading"></span>
                            </a>
                      <button class="btn btn-default">
                          重置 <i class="fa fa-refresh"> </i></button>
                  </div>
              </div>
            </div>
            </div>

            <div class="row" id="list" v-cloak>
              <div class="col-lg-12">
              <div class="ibox float-e-margins">

                  <div class="ibox-content">

                  <div class="table-responsive">
                  <table class="table table-bordered table-hover dataTables-example" >
                  <thead>
                  <tr>
                    <th>日期</th>
                    <th>姓名</th>
                    <th>听单级别</th>
                    <th>司机手机号</th>
                    <th>流水金额(元)</th>
                    <th>完成单量</th>
                    <th>在线时长(小时)</th>
                    <th>服务时长(小时)</th>
                    <th>出车里程(公里)</th>
                    <th>订单里程(公里)</th>
                  </tr>
                  </thead>

                  <tfoot>
                  <tr>
                    <th>日期</th>
                    <th>姓名</th>
                    <th>听单级别</th>
                    <th>司机手机号</th>
                    <th>流水金额(元)</th>
                    <th>完成单量</th>
                    <th>在线时长(小时)</th>
                    <th>服务时长(小时)</th>
                    <th>出车里程(公里)</th>
                    <th>订单里程(公里)</th>
                  </tr>
                  </tfoot>
                  </table>
                      </div>

                  </div>
              </div>
          </div>
            </div>


        </div>

    </div>
</div>



<!-- Mainly scripts -->
<script src="js/jquery-3.1.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="js/plugins/slimscroll/jquery.slimscroll.min.js"></script>
<script src="js/inspinia.js"></script>
<script src="js/axios.js"></script>
<!-- Custom and plugin javascript -->



<script src="js/vue.js"></script>
<script src="js/plugins/dataTables/datatables.min.js"></script>
<script src="js/plugins/datapicker/bootstrap-datepicker.js"></script>
<script src="js/plugins/datapicker/locales/bootstrap-datepicker.zh-CN.min.js"></script>

<script>

var vm=new Vue({
  el:"#data_report",
  data:{
      start_time:"",
      end_time:"",
      name:"",
      phone:"",
      loading:false,
      name:""
  },
  methods:{
    getDateValue:function(){
      this.start_time=$("#startDate").val();
      this.end_time=$("#endDate").val();
    },

    tableReload:function(){
      var vm=this;
      this.loading=true;
      this.getDateValue();
      requestUrl="http://mapleran.iask.in:8888/data_report/finish_order.do?start_time="+vm.start_time+"&end_time="+vm.end_time+"&name="+vm.name+"&phone="+vm.phone;
      $('.dataTables-example').DataTable().ajax.url(requestUrl).load();
      setTimeout("vm.loading=false",500);
    }
  },
  created:function(){
      this.start_time = getDay(-1);
      this.end_time=getDay(-1);
      this.isLoading=false;
  },
  mounted: function(){

  }
});

var checkAuth=new Vue({
  el:"#page-wrapper",
  data:{
    name:""
  },
  methods:{
    getName:function(){
      var vm=this;
      axios.post('http://mapleran.iask.in:8888/user/get_user_info.do')
      .then(function(response){
          if (response.data.status===0) {
              vm.name=response.data.data.name;
            }else {
              alert("登录超时或未登录,请重新登录")
              window.location.href="http://mapleran.iask.in:8888/sfv/login.html"
            }
          }).catch(function(err){
        console.log(err);
      })
    }
  },
  created:function(){
    this.getName();
  }
});


$(document).ready(function(){
  $('.dataTables-example').DataTable({
    pageLength: 10,
    responsive: true,
    serverSide:true,
    ordering:false,
    ajax:"http://mapleran.iask.in:8888/data_report/finish_order.do?start_time="+vm.start_time+"&end_time="+vm.end_time+"name="+vm.name+"phone"+vm.phone,
    columns: [
        { data:"date"},
        { data: "name" },
        { data: "checkLevelName" },
        { data: "phone" },
        { data: "finishFlowfee" },
        { data: "finishFinishCnt" },
        { data: "finishServeTime" },
        { data: "finishOnlineTime" },
        { data: "finishWorkDistance" },
        { data: "finishServeDistance" }
    ],
    dom: '<"html5buttons"B>Tfgitlp',
    "columnDefs":[{
            "render": function(data, type, row) {
                return '<a href="">'+data+'</a>';
            },
            "targets": 1
        }],
    buttons: [
        {extend: 'copy'},
        {extend: 'csv'},
        {extend: 'excel', title: 'ExampleFile'},
        {extend: 'pdf', title: 'ExampleFile'},

        {extend: 'print',
            customize: function (win){
                $(win.document.body).addClass('white-bg');
                $(win.document.body).css('font-size', '10px');

                $(win.document.body).find('table')
                    .addClass('compact')
                    .css('font-size', 'inherit');
            }
        }
    ],
    language: {
        processing: "加载中...",
        aria: {
            sortAscending: ": 以升序排列此列",
            sortDescending: ": 以降序排列此列"
        },
        loadingRecords: "数据载入中...",
        emptyTable: "表中数据为空",
        info: "<strong>司机已完成订单流水统计报表</strong>&nbsp&nbsp共 <span class='badge badge-primary'>_TOTAL_</span> 条数据",
        infoEmpty: "无数据",
        infoFiltered: "(由 _MAX_ 项过滤得到)",
        infoPostFix: "",
        infoThousands: ",",
        lengthMenu: "每页显示 _MENU_",
        search: "搜索:",
        zeroRecords: "没有匹配结果",
        paging: {
            first: "首页",
            previous: "上页",
            next: "下页",
            last: "末页"
        },
        paginate: {
            previous: "上一页",
            next: "下一页",
            last: "尾页",
            first: "首页"
        }
    }

});

      $('#date_added').datepicker({
                format: "yyyy-mm-dd",
                keyboardNavigation: false,
                autoclose: true,
                todayHighlight: true,
                language: "zh-CN"
        });

  });






function getDay(day){
    var today = new Date();

    var targetday_milliseconds=today.getTime() + 1000*60*60*24*day;

    today.setTime(targetday_milliseconds);

    var tYear = today.getFullYear();
    var tMonth = today.getMonth();
    var tDate = today.getDate();
    tMonth = doHandleMonth(tMonth + 1);
    tDate = doHandleMonth(tDate);
    return tYear+"-"+tMonth+"-"+tDate;
}
function doHandleMonth(month){
    var m = month;
    if(month.toString().length == 1){
        m = "0" + month;
    }
    return m;
}


</script>
</body>

</html>
